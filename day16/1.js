const test = `.|...┐....
|.-.┐.....
.....|-...
........|.
..........
.........┐
..../.┐┐..
.-.-/..|..
.|....-|.┐
..//.|....`;

const raw = `┐..................-...|..............................|./................-.....................┐.../..........
.-....../.....-..........|..-.........................|............/.......................┐....┐......-......
........|...┐..............|/.........|...../...............................┐../............../...............
...................-.............-.|......-................┐........-...............-....┐..../┐....|..┐......
.............|............┐....................../..........┐..../┐...........................................
..............................|.............../..|......-......./........|..............................|..-.┐
..............-............/|...┐..┐./.┐............./.............-.......┐............./../............-....
.........................................|.........../................................/..........|......|../..
......|.........┐..┐..............................|.....-┐.-.┐...........|...............-....-....┐..........
...........................┐┐....|......|..............|....-../.....┐|....|┐........../..-...................
...........-..../.|.......-|...-.......................|.......-.|..../........................┐/.............
.....................-.............┐.............../............................................┐┐............
......-..........-.-..|...........|...........................┐...............................|...........|...
................--...┐........┐.................../................................../............-...........
...............|../............/...../......./..┐............|..../-...........|..................┐.-.........
|....................|-.┐...........┐...┐.............................................../................┐....
┐.|................┐.┐...................┐....-./....┐......../...................-.....................-.....
...................................................|........../......┐.................|..┐.............../...
................/.............|......|...........-......................|...-.................../../..|.....-.
.................|-..|.........................-............┐....-./......-......../............/.....|.......
.....|.........-.....-.....-................/┐..........-........|...┐../..|.......-.........-...........-....
......................./.........../........|............┐............../........./.....┐....-/...............
/........./.......|........|..../../........|............................┐........./-..-..............|.....|.
...........|.........-/........-...|/.............................-....|.....┐........................|.......
.|..┐............/.-..........┐........-.............../.......┐...........┐..............┐../-..-|.|-........
..┐-|.......................┐.......┐.┐.....┐............-...../.......-....../.............................-.
.-........................|........../.....................................-....┐.............................
..../.............-.................┐.|........................./............/.|..../../................┐-....
........../-................./........|......-../........|..-........./........./...........┐............┐....
......../.......................┐..-............-...................┐.....................┐/........┐...../...
....../....|..........-.....-/.................-...┐..........................................................
/.........┐.............-....|.-..┐...../../......./|............................................./...../.....
.......-..|............./.............../|....../..................┐....--..-./............./............./..-
-...........|............/.........-..|..................../....................../...........|...┐┐..........
/...-........../....................................|.......-.....|............|........././..┐...............
....................../....┐........|.....|....┐.......-............|┐....┐../.....--.....-.|.................
..../........-.....┐........┐.....┐...............|/..................|........./...-......|.................|
.......................-.......//..................|...........|-....-..-...........-.......-....┐...../....┐.
..................-..../......./-............/.../...┐...┐../............┐┐.|.................................
........../.........|...-..........--....................../.......................-......../......┐..........
..|........../...........|............./...............|........-....┐.....┐...............-.....-....../.-...
...../.-..|┐...|...............................-...|....┐......|.............../.┐............┐............┐..
................┐/.....|..........┐.................../........┐./...................-........................
.........┐...../..|............|...............|.-.....................┐....┐┐.|........../.......|...........
......................┐┐..../.....┐.....┐..........|....................┐.....................................
.┐......./............-┐........../.........-...../....../....-..............-........................┐.....|.
...........┐.......-.....┐...┐/.......-..............-...........┐...................../.................┐....
............-.../.....|..............-.............|......|.......|..|.............../...|.....┐..............
................-..................┐..|............./.................┐....|..//.......|.../..................
........|.../...|....../...┐....................../....-...............-........|..........................|..
..|...../..............................-............|..........-........|.........../..|..|...................
.....-..........-.....-.........................................|.........┐....-.....┐...........-..../...|...
.-.-........../.................../...........-................|..-............../..-..-......................
/-┐.........................-|.........-......|....|-...........-...................................-...┐.....
...┐.........|.............././...........|./.................-........┐.........┐.../|........./....┐┐.......
..|.................-......┐./....||.........┐....|..........-......|.................┐..........┐.....-../...
......../.|................................../...................|..┐┐.....--...................-..|..........
.-........-......./...┐....|....../..........-./......./..|................┐/......../......../....../........
...-....../.|........./.............┐.....|../.-./.......................-....|.........┐......|/..........|..
.....|................//.┐......|.┐/.................................|-...//........./...-.-............┐.....
.............../...............┐..-....................-..../........../....-...............|-.......┐../...┐.
..|......┐........./../..................|....|................|┐.|....┐....-.|.......-../......||.-.|....┐./.
......|./.................┐............|.......................┐........-.....-...../..........┐......-.../..|
.....|.┐....┐..............-......-./......./......................../............|..............|............
..............................┐..................../................|.................-......./.........../...
.......-.....-..........┐..-...../.....┐.┐..............┐..┐....../.|.../...............-..................┐..
.................|..................-.┐....................................┐.....-............................
...-.......|........-....-.......-....-..........-.-..┐.......................................┐.-.../......../
.............-......┐................-.....-.....-/......./...┐┐../.................┐....-......./..-.....-|..
....┐.............|..-......./-......|............┐.........-........┐..../...┐.......|.|..-...┐..............
.....................-....................................../.......┐....┐........................../┐..../┐..
........-............┐....┐./...........┐.-........./........./..┐.........................../....-..|......|.
..................../.........../.┐..............-............┐.........┐/...┐..................-.............
.-...┐......┐.............................................................-.............┐.┐.-......|..........
................|..............|.-........../......┐.............|............./.|..-|..........|.............
...-........../....┐.../.../.........................................................../.........|.-......-...
..-....................-..........................|..../.......|........|../......./....../...-......../....-.
........┐............................-.......┐...../┐......|┐......-............./.........-..................
...../...../|..............|.-.....┐....-/...........┐...............┐.┐.......................-.-............
......┐.......┐.....................|................................┐.....┐..............................┐./.
┐...............................-.............-../-............................./...............┐.|...........
......|......|................-|..-....┐/....┐...................-...........|...../....................┐┐....
.............../..............-...|....................┐┐..............-....┐..........┐...............|....|.
...┐.-.......|..-/...................../|............┐......-.../...................../.......................
........../........./.........-....┐........................|./......./..............-...-....................
....-|-..............┐.......................┐.................|.......┐.........../..........-......./.......
..-...........................|┐.................┐................/┐................................../.|.....
......┐.................................|........┐./............-..............┐..........-.........../..-....
................-..........|.............|.....|....................-..........┐......|-┐....|...........-....
...|.........../┐............./.........┐........┐....................|...........................-.┐.........
../.|...................././......-..............-┐.....-........-.|...........┐......-./..-..................
......┐.......-..-..............................-................|.................../........................
..┐..-................/..-....-........./..........................-.../...........................-..........
............./-./.┐........./....-....................././.....|............-...............|./...........-|..
...................-...┐.....┐....................../............--....................../...........┐........
.............-.....┐......┐./........................../.....................-...................┐.........-|.
.....┐.........┐.../......................┐..................|.............................┐.|........./.....|
.....┐.....┐./..............-............../..............┐.......|........../..//.-...-.┐......../.........┐.
..............┐...┐..........................┐...┐./.-...|.........|.......|..┐../.........................|..
.┐..|......┐.┐┐.........../....../....../......./................../..|................/....|.................
./|............./...................................┐.-....┐..┐|./.-.............................┐.......┐....
┐./........./.....┐............................/.../...┐....................|..............|.|............/|..
..┐............┐............┐.....-..........┐.......|../.|......./|......-...--...-..┐......|./.-......-.....
...............┐........|............┐|....|..┐.......-................/.........|....┐-.|.|..../-.......|....
...................|/.............|............/................|..|.┐.|.........|...┐........................
..................|../..../.......-................................-......................-.........|.......┐.
...............┐...../......┐./...../............/...........-..........┐....../.....┐.....┐......|...........
../........┐.....|..................┐......./.......-../.......┐.../.|....................................|...
.|.|..┐....┐.|./.../........................./........-..┐.../.............┐.............................|....
..................|...┐................-..-/..................-...|./..................-..|...................`;

const maze = raw.split("\n").map((row) => row.split(""));
const walkers = [{ x: 0, y: 0, direction: ">", path: [] }];

function walk(walker) {
  const { x, y, path } = walker;
  if (x < 0 || y < 0 || x >= maze[0].length || y >= maze.length) {
    return;
  }
  const symbol = maze[y][x];
  if(symbol === ',') {
    return;
  }

  path.push({ x, y, direction: walker.direction, symbol });

  if (symbol === "|" && (walker.direction === ">" || walker.direction === "<")) {
    walker.direction = 'v'
    const newWalker = { x, y: walker.y - 1, direction: '^', path: [] };
    walkers.push(newWalker);
    maze[y][x] = ","; // remove the split to prevent infinite loop
    walk(newWalker);
  }
  if (symbol === "-" && (walker.direction === "v" || walker.direction === "^")) {
    walker.direction = '<'
    const newWalker = { x: walker.x + 1, y, direction: '>', path: [] };
    walkers.push(newWalker);
    maze[y][x] = ","; // remove the split to prevent infinite loop
    walk(newWalker);
  }
  if (symbol === "/") {
    switch (walker.direction) {
      case ">":
        walker.direction = "^";
        break;
      case "<":
        walker.direction = "v";
        break;
      case "^":
        walker.direction = ">";
        break;
      case "v":
        walker.direction = "<";
        break;
    }
  }
  if (symbol === "┐") {
    switch (walker.direction) {
      case ">":
        walker.direction = "v";
        break;
      case "<":
        walker.direction = "^";
        break;
      case "^":
        walker.direction = "<";
        break;
      case "v":
        walker.direction = ">";
        break;
    }
  }

  switch (walker.direction) {
    case ">":
      walker.x++;
      break;
    case "<":
      walker.x--;
      break;
    case "^":
      walker.y--;
      break;
    case "v":
      walker.y++;
      break;
  }

  walk(walker);
}

walk(walkers[0]);

const walkedTiles = walkers.map((walker) => walker.path.map(t => ({ x: t.x, y: t.y, d: t.direction }))).flat();
const uniqueTiles = walkedTiles.filter((tile, index, self) =>
  index === self.findIndex((t) => t.x === tile.x && t.y === tile.y)
);

let res = 0;
const outMaze = maze.map((row, y) => row.map((cell, x) => {
  const hit = uniqueTiles.find(t => t.x === x && t.y === y);
  if(hit) {
    res = res + 1;
    return 'X';
  }
  return cell;
}));

// console.log(outMaze.map((row) => row.join("")).join("\n"));
console.log(res);