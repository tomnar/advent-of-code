const test = `#.#####################
#.......#########...###
#######.#########.#.###
###.....#.>.>.###.#.###
###v#####.#v#.###.#.###
###.>...#.#.#.....#...#
###v###.#.#.#########.#
###...#.#.#.......#...#
#####.#.#.#######.#.###
#.....#.#.#.......#...#
#.#####.#.#.#########v#
#.#...#...#...###...>.#
#.#.#v#######v###.###v#
#...#.>.#...>.>.#.###.#
#####v#.#.###v#.#.###.#
#.....#...#...#.#.#...#
#.#########.###.#.#.###
#...###...#...#...#.###
###.###.#.###v#####v###
#...#...#.#.>.>.#.>.###
#.###.###.#.###.#.#v###
#.....###...###...#...#
#####################.#`;

const raw = `#.###########################################################################################################################################
#.#...###.......###...#...#...#...............#...#.......#...#####.....#.........#...#...#...#.....#...#...#...#...#...#.........#.....#...#
#.#.#.###.#####.###.#.#.#.#.#.#.#############.#.#.#.#####.#.#.#####.###.#.#######.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.#.#.#.#######.#.###.#.#.#
#.#.#.#...#.....#...#...#.#.#.#.....#.........#.#.#.#.....#.#...###.#...#.....#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#.....#.#...#.#.#
#.#.#.#.###.#####.#######.#.#.#####.#.#########.#.#.#.#####.###.###.#.#######.#.###.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.#.###.#.#####.#.###.#.#
#...#.#.#...###...#.....#.#.#.>.>...#.#...#...#.#.#.#.....#.#...#...#...#.....#...#.#...#.#.#.#.#...#.#...#.#.#.#.#.#.#.#...#...#...#.#...#.#
#####.#.#.#####.###.###.#.#.###v#####.#.#.#.#.#.#.#.#####.#.#.###.#####.#.#######.#.#####.#.#.#.###.#.#####.#.#.#.#.#.#.#.#####.#.###.#.###.#
#.....#.#.....#.....#...#.#.###...#...#.#.#.#.#.#.#.#.....#.#.###...#...#.....#...#...#...#.#.#...#.#.#.....#.#.#.#.#.#.#.#.....#...#.#.#...#
#.#####.#####.#######.###.#.#####.#.###.#.#.#.#.#.#.#.#####.#.#####.#.#######.#.#####.#.###.#.###.#.#.#.#####.#.#.#.#.#.#.#.#######.#.#.#.###
#.#...#.#.....#.......###...#.....#...#.#.#.#.#.#.#.#.#...#.#.>.>.#.#.#...###.#.###...#...#.#...#.#...#.>.>.#.#.#.#.#.#.#.#.#...#...#...#...#
#.#.#.#.#.#####.#############.#######.#.#.#.#.#.#.#.#.#.#.#.###v#.#.#.#.#.###.#.###.#####.#.###.#.#######v#.#.#.#.#.#.#.#.#.#.#.#.#########.#
#.#.#...#.....#.#...........#.......#.#.#.#.#...#.#.#...#.#.###.#.#.#.#.#.#...#.>.>.#.....#...#.#.#.......#...#.#.#...#.#.#.#.#.#.#.........#
#.#.#########.#.#.#########.#######.#.#.#.#.#####.#.#####.#.###.#.#.#.#.#.#.#####v###.#######.#.#.#.###########.#.#####.#.#.#.#.#.#.#########
#.#.#.........#...#.....#...#.......#.#.#.#...#...#.#.....#.#...#...#.#.#...#...#...#.#.....#.#...#.......#...#.#...#...#.#...#...#.........#
#.#.#.#############.###.#.###.#######.#.#.###.#.###.#.#####.#.#######.#.#####.#.###.#.#.###.#.###########.#.#.#.###.#.###.#################.#
#.#.#...#...#...#...#...#.###...#...#...#...#.#.#...#...#...#.......#.#.#.....#.....#.#...#.#.....#######...#.#.....#...#...#...............#
#.#.###.#.#.#.#.#.###.###.#####.#.#.#######.#.#.#.#####.#.#########.#.#.#.###########.###.#.#####.###########.#########.###.#.###############
#.#.#...#.#.#.#.#...#...#.....#...#.......#.#.#.#.###...#.#.........#...#...........#...#.#...#...#.........#...#.......#...#.........#...###
#.#.#.###.#v#.#.###.###.#####.###########.#.#.#.#.###.###.#.#######################.###.#.###.#.###.#######.###.#.#######.###########.#.#.###
#...#.....#.>.#...#.###.......#...#.......#...#...#...#...#.......#...#...#.......#...#.#...#.#.#...#.....#...#.#.#...#...#.........#...#...#
###########v#####.#.###########.#.#.###############.###.#########.#.#.#.#.#.#####.###.#.###.#.#.#.###.###.###.#.#.#.#.#.###.#######.#######.#
#.........#...#...#.....#...#...#.#.#...###...#...#...#.###...#...#.#.#.#.#.....#.#...#...#.#...#.....###...#...#...#...###.......#.#.......#
#.#######.###.#.#######.#.#.#.###.#.#.#.###.#.#.#.###.#.###.#.#.###.#.#.#.#####.#.#.#####.#.###############.#####################.#.#.#######
#.......#.....#.......#.#.#.#...#.#...#...#.#...#...#...#...#.#...#.#.#.#.......#...#...#...###...#.........#...#...#.......#.....#...#...###
#######.#############.#.#.#.###.#.#######.#.#######.#####.###.###.#.#.#.#############.#.#######.#.#.#########.#.#.#.#.#####.#.#########.#.###
#...###...........###...#.#.....#.........#.#.......#...#...#.#...#.#.#...#...#.......#.#...#...#.#...........#...#.#.....#.#.....#...#.#...#
#.#.#############.#######.#################.#.#######.#.###.#.#.###.#.###.#.#.#.#######.#.#.#.###.#################.#####.#.#####.#.#.#.###.#
#.#.#.......#.....#.......#...#.........#...#.#...#...#.#...#.#.#...#.###...#.#.#.......#.#.#.#...#...###...........#...#.#.#...#...#...#...#
#.#.#.#####.#.#####.#######.#.#.#######.#.###.#.#.#.###.#.###.#.#.###.#######v#.#.#######.#.#.#.###.#.###.###########.#.#.#.#.#.#########.###
#.#.#.#...#...#...#.#...#...#...###...#.#.#...#.#.#...#.#...#.#.#...#.#...#.>.>.#.....#...#.#.#.#...#.....#...#.......#.#.#...#.......#...###
#.#.#.#.#v#####.#.#.#.#.#.#########.#.#.#.#.###.#.###.#.###.#.#v###.#.#.#.#.#v#######.#.###.#.#.#.#########.#.#.#######.#.###########.#.#####
#.#.#...#.>.###.#.#...#...#...#.....#...#.#...#.#.#...#.#...#.>.>...#.#.#...#.#.......#.#...#.#.#...#.......#.#.....#...#.........###...#...#
#.#.#####v#.###.#.#########.#.#.#########.###.#.#.#.###.#.#####v#####.#.#####.#.#######.#.###.#.###.#.#######.#####.#.###########v#######.#.#
#.#.#.....#.....#.......###.#.#.......#...#...#.#.#...#.#.#####.....#.#...#...#...#...#.#.###.#.###...###.....#...#.#...#.....#.>.#.......#.#
#.#.#.#################.###.#.#######.#.###.###.#.###.#.#.#########.#.###.#.#####.#.#.#.#.###.#.#########.#####.#.#.###.#.###.#.#v#.#######.#
#.#.#.....###...........#...#.#...#...#...#.....#...#.#.#.#.........#.#...#.....#.#.#.#.#...#.#.#...#...#.#...#.#...#...#.###...#.#.#.......#
#.#.#####.###.###########.###.#.#.#.#####.#########.#.#.#.#.#########.#.#######.#.#.#.#.###.#.#.#.#.#.#.#v#.#.#.#####.###.#######.#.#.#######
#.#.#.....#...###...#...#...#.#.#.#.#...#.#.......#.#.#...#.........#.#.#...#...#.#.#.#.#...#.#.#.#.#.#.>.>.#.#.....#.....#.....#...#...#...#
#.#.#.#####.#####.#.#.#.###.#.#.#.#.#.#.#.#.#####.#.#.#############.#.#.#.#.#.###.#.#.#.#.###.#.#.#.#.###v###.#####.#######.###.#######.#.#.#
#.#.#.....#...#...#.#.#.###.#.#.#.#.#.#.#...#.....#.#.#.............#...#.#...###.#.#.#.#.#...#...#.#.#...###.#.....#.......#...#.....#...#.#
#.#.#####.###.#.###.#.#.###.#.#.#.#v#.#.#####.#####.#.#.#################.#######.#.#.#.#.#.#######.#.#.#####.#.#####.#######.###.###.#####.#
#.#.#.....###.#.#...#.#...#.#.#.#.>.>.#.#...#.....#...#...............###.......#...#.#.#.#.....###...#.....#.#.....#...#...#.....###...#...#
#.#.#.#######.#.#.###.###.#.#.#.###v###.#.#.#####.###################.#########.#####.#.#.#####.###########.#.#####.###.#.#.###########.#.###
#.#.#.......#...#...#...#.#.#.#.#...###...#.#...#.....#...............#.........#...#.#.#.#...#.#.......#...#.....#.###...#.........#...#.###
#.#.#######.#######.###.#.#.#.#.#.#########.#.#.#####.#.###############.#########.#.#.#.#.#.#.#.#.#####.#.#######.#.###############.#.###.###
#.#.........###.....#...#.#.#...#.......###...#.......#.............###...........#.#...#.#.#.#.#.....#...###...#...#...............#.....###
#.#############.#####.###.#.###########.###########################.###############.#####.#.#.#.#####.#######.#.#####.#######################
#.#.......#...#...#...###.#...#.........#...#...#######.............#.....###.....#.....#.#.#...#...#.......#.#.....#...........#.....#...###
#.#.#####.#.#.###.#.#####.###.#.#########.#.#.#.#######.#############.###.###.###.#####.#.#.#####.#.#######.#.#####.###########.#.###.#.#.###
#.#.#.....#.#.###.#.#...#.....#.#...#.....#...#...###...#.......#...#...#.....###.......#.#...#...#.........#.#.....#...........#.#...#.#...#
#.#.#.#####.#.###.#.#.#.#######.#.#.#.###########.###.###.#####.#.#.###.#################.###.#.#############.#.#####.###########.#.###.###.#
#.#.#.#...#.#...#...#.#.###...#...#...#.....#...#...#.....#...#...#...#...#...........#...#...#...............#.#...#.............#...#...#.#
#.#.#.#.#.#.###.#####.#.###.#.#########.###.#.#.###.#######.#.#######.###.#.#########.#.###.###################.#.#.#################.###.#.#
#...#.#.#.#.#...#...#.#.#...#.###.....#...#...#.....###.....#.#.......#...#.#.........#.....#.....#.............#.#.#...............#.....#.#
#####v#.#.#.#.###.#.#.#.#.###.###.###.###.#############.#####.#.#######.###.#.###############.###.#.#############.#.#.#############.#######.#
#...#.>.#.#.#...#.#.#.#.#...#...#...#.....###...#.....#.....#...#...###.#...#.......#...#...#.#...#.............#.#.#.......###...#...#...#.#
#.#.#v###.#.###.#.#.#.#.###.###.###.#########.#.#.###.#####.#####.#.###.#.#########.#.#.#.#.#.#.###############.#.#.#######.###.#.###.#.#.#.#
#.#.#...#.#...#...#...#...#.#...###.........#.#.#.#...#...#.#...#.#...#...#.........#.#.#.#.#.#.#...#...........#.#.#.....#.....#.#...#.#.#.#
#.#.###.#.###.###########.#.#.#############.#.#.#.#.###.#.#v#.#.#.###.#####.#########.#.#.#.#.#.#.#.#.###########.#.#.###.#######.#.###.#.#.#
#.#.#...#...#.#...........#.#.#...#...#.....#.#.#.#.#...#.>.>.#.#.#...#...#...#...###.#.#.#.#.#.#.#.#.....###...#.#.#.#...#...#...#.....#.#.#
#.#.#.#####.#.#.###########.#.#.#.#.#.#v#####.#.#.#.#.#####v###.#.#.###.#.###v#.#.###.#.#.#.#.#.#.#.#####v###.#.#.#.#.#.###v#.#.#########.#.#
#.#...#...#.#.#...#.......#.#.#.#.#.#.>.>...#.#.#.#...#####...#.#.#...#.#.#.>.>.#...#.#.#.#.#.#.#.#...#.>.>.#.#.#.#...#.#.>.#...###.....#...#
#.#####.#.#.#.###.#.#####.#.#.#.#.#.###v###.#.#.#.###########.#.#.###.#.#.#.#v#####.#.#.#.#.#.#.#.###.#.#v#.#.#.#.#####.#.#v#######.###.#####
#.#.....#.#...#...#.#.....#.#.#.#...###...#.#.#.#.#...#.......#...#...#.#...#.....#.#.#.#.#.#.#.#...#.#.#.#...#.#...###.#.#...#...#...#.....#
#.#.#####.#####.###.#.#####.#.#.#########.#.#.#.#.#.#.#.###########.###.#########.#.#.#.#.#.#.#.###.#.#.#.#####.###.###.#.###.#.#.###.#####.#
#.#.#.....#...#.....#.....#.#.#.......###.#...#.#...#.#...........#...#.#.........#...#.#.#.#.#.#...#.#.#.#...#.....#...#.#...#.#.#...#...#.#
#.#.#.#####.#.###########.#.#.#######.###.#####.#####.###########.###.#.#.#############.#.#.#.#.#.###.#.#.#.#.#######.###.#.###.#.#.###.#.#.#
#...#.......#...........#.#.#...#...#.#...###...#...#.#...........###.#.#.#...###.....#.#.#.#.#.#.#...#.#...#...#...#...#.#.....#...#...#...#
#######################.#.#.###.#.#.#.#.#####.###.#.#.#.#############.#.#.#.#.###.###.#.#.#.#.#.#.#.###.#######.#.#.###.#.###########.#######
#.................#.....#.#.#...#.#...#.....#.#...#...#.#...........#...#...#.....#...#...#...#...#...#.#.......#.#.###...#...........###...#
#.###############.#.#####.#.#.###.#########.#.#.#######.#.#########.###############.#################.#.#.#######.#.#######.#############.#.#
#...............#.#.#...#...#...#.....#.....#.#.....###...#.........#.....#.........#...#...#.....###...#...#.....#.......#.#.............#.#
###############.#.#.#.#.#######.#####.#.#####.#####.#######.#########.###.#.#########.#.#.#.#.###.#########.#.###########.#.#.#############.#
#...............#...#.#.#.....#.#.....#.....#.......#...###.....#...#...#.#.......#...#.#.#.#.#...#...#.....#.#.....#.....#...#...#.........#
#.###################.#.#.###.#.#.#########.#########.#.#######.#.#.###.#.#######.#.###.#.#.#.#.###.#.#.#####.#.###.#.#########v#.#.#########
#.#...........#...#...#...#...#...#.....#...#...#...#.#.#.......#.#...#.#.###.....#.#...#.#...#...#.#.#.....#.#...#...#.......>.#...###...###
#.#.#########.#.#.#.#######.#######.###.#.###.#.#.#.#.#.#.#######.###.#.#.###v#####.#.###.#######.#.#.#####.#.###.#####.#######v#######.#.###
#.#.#.........#.#.#.......#.#...###...#...#...#.#.#.#.#.#.....###.#...#.#.#.>.>.....#...#...#.....#.#.....#...###...###.......#...#.....#...#
#.#.#.#########.#.#######.#.#.#.#####.#####.###.#.#.#.#.#####v###.#.###.#.#.#v#########.###.#.#####.#####.#########.#########.###.#.#######.#
#.#.#.#...#...#.#.#...###.#.#.#.#...#.....#...#.#.#.#.#.#...>.>.#.#.#...#.#.#.#.....#...#...#.....#.#.....###.......#...#.....#...#.#.......#
#.#.#.#.#.#.#.#.#.#.#.###.#.#.#.#.#.#####v###.#.#.#.#.#.#.###v#.#.#.#.###.#.#.#.###.#.###.#######.#.#.#######.#######.#.#.#####.###.#.#######
#...#...#.#.#.#.#.#.#...#.#.#.#.#.#.#...>.>...#...#.#.#...#...#...#.#.#...#.#...#...#.#...#.......#.#...#...#.....#...#.#.....#.....#.......#
#########v#.#.#.#.#.###.#.#.#.#.#.#.#.###v#########.#.#####.#######.#.#.###.#####.###.#.###.#######.###.#.#.#####.#.###.#####.#############.#
###...###.>.#.#.#.#...#.#.#.#.#.#.#.#...#...#...###...#.....#.....#...#...#...#...###.#.###...#...#.#...#.#.#...#.#...#.....#.#.............#
###.#.###v###.#.#.###.#.#.#.#.#.#.#.###.###.#.#.#######.#####.###.#######.###.#.#####.#.#####.#.#.#.#.###.#.#.#.#.###.#####.#.#.#############
#...#.#...###.#.#.#...#...#.#.#.#.#...#.###...#...#...#.......#...#.......#...#.....#.#.#.....#.#...#.#...#...#.#.###.....#...#.............#
#.###.#.#####.#.#.#.#######.#.#.#.###.#.#########.#.#.#########.###.#######.#######.#.#.#.#####.#####.#.#######.#.#######.#################.#
#...#.#.....#...#.#.......#...#.#...#.#.#.........#.#...###.....###...#...#.#####...#...#.#...#...#...#.#.......#.#...###...#...............#
###.#.#####.#####.#######.#####.###.#.#.#.#########.###.###.#########.#.#.#.#####.#######.#.#.###.#.###.#.#######v#.#.#####.#.###############
#...#.......###...#...#...#.....#...#...#.........#...#.....#...#####.#.#.#.#.....#.......#.#...#.#...#.#.#...#.>.>.#...#...#...............#
#.#############.###.#.#.###.#####.###############.###.#######.#.#####.#.#.#.#.#####.#######.###.#.###.#.#.#.#.#.#v#####.#.#################.#
#.............#.....#...###...#...#...........#...###.#.......#.....#...#.#.#.....#.......#.#...#...#...#...#.#.#.....#.#.#.............#...#
#############.###############.#.###.#########.#.#####.#.###########.#####.#.#####.#######.#.#.#####.#########.#.#####.#.#.#.###########.#.###
#.............#...#####.....#.#...#.........#.#.#.....#.#...........#...#...#...#.......#.#.#.#...#.......###...#.....#...#...........#...###
#.#############.#.#####.###.#.###.#########.#.#.#.#####.#.###########.#.#####.#.#######.#.#.#.#.#.#######.#######.###################.#######
#...............#.......#...#...#.#.........#.#.#.......#.............#...#...#.........#...#.#.#.#.......#.......#...###.......#...#.......#
#########################.#####.#.#.#########.#.#########################.#.#################.#.#.#.#######.#######.#.###.#####.#.#.#######.#
#.........................#...#.#.#.........#...#...#.....................#.......#...#...###...#...#.......#.......#...#.#...#...#.#.....#.#
#.#########################.#.#.#.#########.#####.#.#.###########################.#.#.#.#.###########.#######.#########.#.#.#.#####.#.###.#.#
#.............#...#...#...#.#.#...#.......#...###.#.#...................###...###...#.#.#.#.....#.....#.......###.....#.#...#.....#.#...#...#
#############.#.#.#.#.#.#.#.#.#####.#####.###.###.#.###################.###.#.#######.#.#.#.###.#.#####.#########.###.#.#########.#.###.#####
#...#...#.....#.#.#.#...#...#.#...#.....#.....#...#.#.....#.............#...#.......#...#...#...#.......#.....#...###...#.........#.....#...#
#.#.#.#.#v#####.#.#.#########.#.#.#####.#######.###.#.###.#.#############.#########.#########.###########.###.#.#########.###############.#.#
#.#...#.#.>.###.#.#...#.......#.#.#...#.....###...#.#...#.#.#...#.......#.........#.#...#...#...#...#...#.#...#...#...###...............#.#.#
#.#####.#v#.###.#.###.#.#######.#.#.#.#####.#####.#.###.#.#v#.#.#.#####.#########.#.#.#.#.#.###.#.#.#.#.#.#.#####.#.#.#################.#.#.#
#.#...#...#...#.#.#...#.......#.#.#.#.#.....#...#.#.....#.>.>.#.#.#.....#...#.....#...#...#.....#.#.#.#.#.#.#.....#.#.....#.............#.#.#
#.#.#.#######.#.#.#.#########.#.#.#.#.#.#####.#.#.#########v###.#.#.#####.#.#.###################.#.#.#.#.#.#.#####.#####.#.#############.#.#
#.#.#...#...#...#.#.#.........#.#.#.#.#.....#.#...###.....#.#...#.#.#...#.#.#.....#...###...#...#.#.#.#.#.#.#.....#.....#.#.......#...#...#.#
#.#.###.#.#.#####.#.#.#########.#.#.#.#####.#.#######.###.#.#.###.#.#.#.#.#.#####v#.#.###.#.#.#.#.#.#.#.#.#.#####v#####.#.#######.#.#.#.###.#
#.#.###...#.....#.#.#...#...###.#.#.#.#...#.#.....#...###.#.#...#.#.#.#.#.#.....>.>.#.#...#.#.#...#.#.#.#.#.#...>.>.###.#.#.....#...#...#...#
#.#.###########.#.#.###.#.#.###.#.#.#.#.#.#v#####.#.#####.#.###.#.#.#.#.#.#######v###.#.###.#.#####.#.#.#.#.#.###v#.###.#.#.###.#########.###
#...#...#.......#...###.#.#...#.#.#.#.#.#.>.>.#...#.....#...#...#.#.#.#...###...#.#...#.#...#.....#.#.#.#.#...#...#...#.#.#...#...........###
#####.#.#.#############.#.###.#.#.#.#.#.###v#.#.#######.#####.###.#.#.#######.#.#.#.###.#.#######.#.#.#.#.#####.#####.#.#.###v###############
#.....#.#.......#.......#.###.#.#.#.#...###.#.#...#.....###...#...#.#.#.......#...#...#.#...#.....#.#.#.#.#.....#...#...#.#.>.#.......#...###
#.#####.#######.#.#######.###.#.#.#.#######.#.###.#.#######.###.###.#.#.#############.#.###.#.#####.#.#.#.#.#####.#.#####.#.#v#.#####.#.#.###
#.#...#.........#.....#...#...#.#.#.###.....#.#...#.......#...#...#.#.#.....#...#####...###.#.....#.#.#...#.......#.....#...#...#...#...#...#
#.#.#.###############.#.###.###.#.#.###.#####.#.#########.###.###.#.#.#####.#.#.###########.#####.#.#.#################.#########.#.#######.#
#...#...............#.#.###.....#.#.#...#...#...#...#.....###.....#...#...#...#.........#...#...#.#.#.#.......#...#...#.#.........#.........#
###################.#.#.#########.#.#.###.#.#####.#.#.#################.#.#############.#.###.#.#.#.#.#.#####.#.#.#.#.#.#.###################
#...................#.#.#...#...#...#.....#.....#.#...#...#...#...#...#.#.#...#.........#.#...#...#.#.#.....#...#...#...#...#...............#
#.###################.#.#.#.#.#.###############.#.#####.#.#.#.#.#.#.#.#.#.#.#.#.#########.#.#######.#.#####.###############.#.#############.#
#...................#.#.#.#...#...#.............#.......#.#.#.#.#.#.#...#...#.#.....#...#...#...###...#.....#...###.......#...#...#.........#
###################.#.#.#.#######.#.#####################.#.#.#.#.#.#########.#####.#.#.#####.#.#######.#####.#.###.#####.#####.#.#.#########
#...................#...#.....#...#.#...#.........#.....#.#.#...#.#.#.......#.......#.#.....#.#.#.....#.......#...#.....#.......#...#.......#
#.###########################.#.###.#.#.#.#######.#.###.#.#.#####.#.#.#####.#########.#####.#.#.#.###.###########.#####.#############.#####.#
#.....#...........#...###...#.#...#...#...#.......#...#...#.#.....#...#.....#...###...#.....#.#.#...#.#...........#...#.....#.........#.....#
#####.#.#########.#.#.###.#.#.###.#########.#########v#####.#.#########.#####.#.###.###.#####.#.###.#.#.###########.#.#####.#.#########.#####
#...#...###.......#.#.###.#.#...#.#...#.....#.....#.>.>.###.#.#####...#.....#.#.###.#...#...#.#...#.#.#.............#...###...###.......#...#
#.#.#######.#######.#.###.#.###.#.#.#.#.#####.###.#.###.###.#.#####.#.#####v#.#.###.#.###.#.#.###.#.#.#################.#########.#######.#.#
#.#.#...#...###...#.#.#...#...#.#.#.#.#.#...#...#.#.###.#...#...#...#...#.>.>.#...#.#.....#.#.#...#.#...#...............#.........###.....#.#
#.#.#.#.#.#####.#.#.#.#.#####.#.#.#.#.#.#.#.###.#.#.###.#.#####.#.#####.#.#######.#.#######.#.#.###.###.#.###############.###########.#####.#
#.#...#...#...#.#.#.#.#...#...#.#.#.#.#...#.#...#.#.#...#.#.....#...#...#.#######...#.....#.#.#.....#...#...............#...........#.#...#.#
#.#########.#.#.#.#.#.###.#.###.#.#.#.#####v#.###.#.#.###.#.#######.#.###.###########.###.#.#.#######.#################.###########.#.#.#.#.#
#.#.....#...#.#.#.#.#.#...#.#...#.#.#...#.>.>.###.#.#...#.#.....#...#...#...#.........###...#...#.....#.......#.........###.........#.#.#...#
#.#.###.#.###.#.#.#.#.#.###.#.###.#.###.#.#######.#.###.#.#####.#.#####.###.#.#################.#.#####.#####.#.###########.#########.#.#####
#.#.#...#.#...#.#.#.#...#...#.###.#.###.#.......#.#.#...#.#.....#.....#.....#.......#...###...#.#.#...#...#...#.###...#...#...........#.#...#
#.#.#.###.#.###.#.#.#####.###.###.#.###.#######.#.#.#.###.#.#########.#############.#.#.###.#.#.#.#.#.###.#.###v###.#.#.#.#############v#.#.#
#.#.#...#.#...#.#.#.....#...#.#...#...#.#...#...#.#.#...#.#.#...#...#...#...........#.#...#.#.#.#.#.#...#.#.#.>.>.#.#.#.#.#.....#...#.>.#.#.#
#.#.###.#.###.#.#.#####.###.#.#.#####.#.#.#.#.###.#.###.#.#.#.#.#.#.###.#.###########.###.#.#.#.#.#.###.#.#.#.###.#.#.#.#.#.###.#.#.#.#v#.#.#
#...###...###...#.......###...#.......#...#...###...###...#...#...#.....#.............###...#...#...###...#...###...#...#...###...#...#...#.#
###########################################################################################################################################.#`;

const tiles = raw.split("\n").map((row) => row.split(""));

const walkers = [];
walkers.push({ r: 0, c: 1, hist: ['0,1'] });

function isValidSymbol(slope, direction) {
  if (slope === ".") {
    return true;
  }
  if (slope === "#") {
    return false;
  }
  if (slope === "<" && direction === ">") {
    return false;
  }
  if (slope === ">" && direction === "<") {
    return false;
  }
  if (slope === "^" && direction === "v") {
    return false;
  }
  if (slope === "v" && direction === "^") {
    return false;
  }
  return true;
}

function walk(walker) {
  let steps = [
    [walker.r, walker.c - 1, "<"],
    [walker.r, walker.c + 1, ">"],
    [walker.r - 1, walker.c, "^"],
    [walker.r + 1, walker.c, "v"],
  ];
  steps = steps.filter(
    (step) =>
      step[0] >= 0 &&
      step[0] < tiles[0].length &&
      step[1] >= 0 &&
      step[1] < tiles.length &&
      isValidSymbol(tiles[step[0]][step[1]], step[2]) &&
      !walker.hist.includes(`${step[0]},${step[1]}`)
  );
  steps.forEach((step, i) => {
    if (i === 0) {
      walker.hist.push(`${step[0]},${step[1]}`);
      walker.r = step[0];
      walker.c = step[1];
    } else {
      const newWalker = {
        r: step[0],
        c: step[1],
        hist: [...walker.hist.slice(0, -1), `${step[0]},${step[1]}`],
      };
      walkers.push(newWalker);
    }
  });
}
for (let i = 0; i < 2500; i++) { // Hacky
  walkers.forEach((walker) => walk(walker));
}

/*
walkers.forEach((walker) => {
  const tiles2 = JSON.parse(JSON.stringify(tiles));
  walker.hist.forEach((step) => {
    const [x, y] = step.split(",");
    tiles2[x][y] = "O";
  });
  console.log(tiles2.map((row) => row.join("")).join("\n"));
  console.log('------------------');
});
*/

walkers.sort((a, b) => b.hist.length - a.hist.length);
console.log(walkers[0].hist.length - 1);